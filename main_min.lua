pico-8 cartridge // http://www.pico-8.com
version 42
__lua__
local d,e,l=split"50,35,85",1,split"90,50,180"function ee()for f=0,x-1do cls()a[f]={}for l=0,x-1do a[f][l]=0local n,c=l/240,f/240local o,t,i,u,n=cos(n)*1,cos(c)*1,sin(n)*1,sin(c)*1,0local r,c=o*cos(.15)-t*sin(.35),o*cos(.15)-t*sin(.15)n=abs(sin(o/4+sin(i/15)))*d[e]n+=abs(sin(u/4+sin(i/15)))*45n+=abs(sin(r/4+sin(t/30)))*35n+=abs(sin(c/4+sin(i/30)))*d[e]n+=abs(sin(c/4+sin(o/30)))*35n+=abs(sin(c/4+sin(u/30)))*d[e]n-=145if(n<=0)n=0else 𝘹+=.00002
a[f][l]|=n&255.99999end end for n=0,x-1do for e=0,x-1do srand(e*n)if(flr(rnd(22))==1and a[e][n]>4)a[e][n]=a[e][n]&~16128|256
if(flr(rnd(44))==2and a[e][n]>4)a[e][n]=a[e][n]&~16128|3328
end end for n=0,8do for f=0,8do a[f+114][n+114]=l[e]𝘹-=.00002end end for n=24,x-1-24,48do for e=24,x-1-24,48do a[e][n]|=2304end end end function ef(n)local e,o=n+1,peek(n)local l,f=peek(e+o),e+o+1local n,d=f+l,{}for f=0,o-3,3do add(d,{(peek(e+f)-peek(n))*peek(n+3),(peek(e+f+1)-peek(n+1))*peek(n+3),(peek(e+f+2)-peek(n+2))*peek(n+3)})end local e={}for n=0,l-4,4do add(e,{peek(f+n),peek(f+n+1),peek(f+n+2),peek(f+n+3)})end local n={peek(n),peek(n+1),peek(n+2),peek(n+3)}return{d,e,n}end nr,𝘦,n,ng=10,0,i function eo()music(0)i=𝘧(2,0,0,500,0,0,0)end function el()i.ay-=.02i.ax+=.05if(i.z-nr>40)i.z-=nr
if(i.z>1000)ed()
if(btn(5))nr=-40ng=true
end function e1()rectfill(0,0,128,128,0)n𝘧()nk()na()rectfill(0,0,128,8,6)print("prion",12,2,8)print("marcospiv 2023",47,2,7)print("🅾️thrust",20,100,8)print("❎ cannon",56,97,8)print("❎+❎ missile",56,103,8)print("<press ❎ to continue>",20,110,7)if(ng)rectfill(0,80,128,128,0)print("loading terrain...",30,110,7)
end n𝘸=time()x=241u,a,s=0,{}𝘫,n𝘣,n𝘦,y=-33,33,1000,0z=12h=z+1c=30p=128-ceil(c/8)*8m=20nw,nj,ey,n2,n4=80,63,63,-3,-300𝘺,𝘦,𝘻,et=0,0,0,125nq,ny,nz=0,.5,0n,nn,n0,n5,n3,𝘬=nil,0,0,0,0,0w,𝘤,nh,𝘭,ei={},{},{},0,50𝘮,𝘯,𝘰,𝘱,𝘲,ne=sin(nq),sin(ny),sin(nz),cos(nq),cos(ny),cos(nz)ec,eu,er,ea,e2,e4,e5,e3,eh=ne*𝘲,-𝘰,ne*𝘯,𝘱*𝘰*𝘲+𝘮*𝘯,𝘱*ne,𝘱*𝘰*𝘯-𝘮*𝘲,𝘮*𝘰*𝘲-𝘱*𝘯,𝘮*ne,𝘮*𝘰*𝘯+𝘱*𝘲 b=function()end function na()for n=0,z-1do w[n]={}end end na()function n𝘤()ee()local n=x-1u=x*m s=n/c e8()end function es(n)n.x%=u n.z%=u end function f(n)return n\m end function ez(e,f,n)return(1-n)*e+n*f end function e𝘤(n,e)return n.x-e.x,n.y-e.y,n.z-e.z end function k(n,e)return a[n%u\m][e%u\m]&255.99999end function 𝘳(n,e)return(a[n][e]&16128)>>>8end function nf(n,e)return a[n][e]&255.99999end function n8(n,e,f)return n*ec+e*eu+f*er,n*ea+e*e2+f*e4,n*e5+e*e3+f*eh end function n𝘥(d,o,l,n,e,f)local n,o,l=d,o*cos(n)+l*sin(n),o*-sin(n)+l*cos(n)n,o,l=n*cos(f)+o*sin(f),n*-sin(f)+o*cos(f),l return n*cos(e)+l*sin(e),o,n*-sin(e)+l*cos(e)end function ns(n)return n>𝘫*m and n<n𝘣*m end function nx(n)return n>y*m and n<n𝘦*m end function n𝘨(n)return n>𝘦-200and n<𝘦+200end function n𝘩(n,e)local f=n if(ns(n-u))f=n-u
if(ns(n+u))f=n+u
local n=e if(nx(e-u))n=e-u
if(nx(e+u))n=e+u
return f,n end function n7(n,e,o,l,d,u,f)local c,f,t,n,e,i,o,l,d=f,band(n,-1),band(o,-1),band(e,-1),band(l,-1),band(d,-1),band(u,-1)if(n>e)n,e,f,t=e,n,t,f
if(n>o)n,o,f,i=o,n,i,f
if(e>o)e,o,t,i=o,e,i,t
if n~=e then local o,t,i,e=(i-f)/(o-n),(t-f)/(e-n),min(e,128)if(n>0)l,d,e=f,f,n else l,d,e=f-o*n,f-t*n,0
for n=e,i-1do rectfill(l,n,d,n,c)l+=o d+=t end else l,d=f,t end if o~=e then local u,i=(i-f)/(o-n),(i-t)/(o-e)n𝘪=e ex=min(o,128)if(e<0)d,l,n𝘪=t-i*e,f-u*n,0
for n=n𝘪,ex do rectfill(l,n,d,n,c)d+=i l+=u end else rectfill(l,o,d,o,c)end end function 𝘢(e,f,n)return e*nw/n+nj,f*nw/n+nj end function e8()local n,e,f=0,0,{}for o=x-s,0,-s do f[n]={}for l=0,x-s,s do local d,o=2,nf(l+s\2,o+s\2)d=f[n][(e-1)%c]and o-f[n][(e-1)%c]or o local l=1l=d>=0and 3or 11if(o==0)l=1
f[n][e]=o sset(p+e,p+n,l)e+=1end e=0n+=1end for n=0,1do for e=0,1do sset(p+e+13,p+n+14,7)end end end function e7()sspr(p,p,c,c,0,0,c+1,c+1)pset(nn\s,c+-n0\s,7)for n=1,#r do local n=r[n]local e,f=f(n.x),f(n.z)pset(e\s,c+-f\s,n.return_blip_color())end for n=24,x-1-24,48do for e=24,x-1-24,48do if(𝘳(e,n)==11)rectfill((e-24)/48*6,abs((n-24)/48*6-c),(e-24)/48*6+5+1,abs((n-24)/48*6+5-c+1),0)
end end end function e6()n𝘧()e9()rectfill(0,0,128,128,0)if n𝘨(a[1][1]&255.99999)then local e={}for n=h*h-1,0,-1do local o,l=(n%h+𝘫)%x,(n\h+y)%x local c,u,i=n%h*m+𝘫*m,nf(o,l),n\h*m+y*m local f,t,d=c-𝘺,u-𝘦,i-𝘻 if n%h==0then f+=n5*m elseif n%h==z then f+=n5*m-m elseif n\h==0then d+=n3*m elseif n\h==z then d+=n3*m-m end f,t,d=n8(f,t,d)local d,r=𝘢(f,t,d)add(e,{f,t,i,d,r,o,l})if n%h~=0and n%h<h-1and n\h~=0then local n=𝘳(o,l)srand(o*l)if(n>0)𝘧(𝘳(o,l),c,u,i,nil,nil,nil,nil,ep[n],nil,nil,nil,true,true)
end end for n=1,#e do if n%h~=0and n>h-1then local n,o,l,u=e[n+1],e[n-h+1],e[n],e[n-h]local e,f,d,t,i,c,o,l,n=n[4],n[5],o[4],o[5],l[4],l[5],u[4],u[5],ev(n[6],n[7],true)if((e-d)*(l-t)-(f-t)*(o-d)<0)n7(e,f,d,t,o,l,n)
if((o-i)*(f-c)-(l-c)*(e-i)<0)n7(o,l,i,c,e,f,n)
fillp()else if n%h==0then local n=abs((n-(z+1))\h-(z+1))if(n<z)for e=#w[n],1,-1do w[n][e]:draw()end
end end end else nk()end na()end function nk()for n=#w,0,-1do for e=#w[n],1,-1do w[n][e]:draw()end end end function n𝘧()for n=#𝘤,1,-1do local n=𝘤[n]n:transform()if(nx(n.d_z)and ns(n.d_x)and n𝘨(n.y))n.is_visible=true add(w[abs(n.d_z-y*m)\m],n)else n.is_visible=false
end end function e9()nn,n0=f(n.x),f(n.z)n5,n3=n.x/m%1,n.z/m%1𝘬=nf(nn,n0)𝘫,n𝘣,y,n𝘦=nn-(h\2-1),h+𝘫-1,n0-(h\2-1),h+y-1end function n𝘫(n)for e=1,#n.t_verts do local n=n.t_verts[e]n[4],n[5]=𝘢(n[1],n[2],n[3])end for e=1,#n.tris do local e=n.tris[e]local d=e[4]if(d&240>0)fillp(42405)else fillp()
local f,o,l=n.t_verts[e[1]],n.t_verts[e[2]],n.t_verts[e[3]]local n,e,t=f[3],o[3],l[3]if n>n4 or e>n4 or t>n4 then if n<n2 and e<n2 and t<n2 then local e,t,n,o,f,l=f[4],f[5],o[4],o[5],l[4],l[5]if max(f,max(e,n))>0and min(f,min(e,n))<128then if((e-n)*(l-o)-(t-o)*(f-n)<0)n7(e,t,n,o,f,l,d)
end end end end fillp()end function em(n)n.d_x,n.d_z=n𝘩(n.x,n.z)local e,f,o=n.d_x-𝘺,n.y-𝘦,n.d_z-𝘻 n.t_x,n.t_y,n.t_z=n8(e,f,o)end function eb(e)e.d_x,e.d_z=n𝘩(e.x,e.z)for o=1,#e.verts do local n,f=e.t_verts[o],e.verts[o]if(e𝘢(e.lock_verts,o))n[1],n[2],n[3]=n𝘥(f[1],f[2],f[3],0,0,0)else n[1],n[2],n[3]=n𝘥(f[1],f[2],f[3],e.ax,e.ay,e.az)
n[1]+=e.d_x-𝘺 n[2]+=e.y-𝘦 n[3]+=e.d_z-𝘻 n[1],n[2],n[3]=n8(n[1],n[2],n[3])end end function e_()for f=#𝘤,1,-1do local n,e=𝘤[f],false if n.life_span~=nil then n.life_span-=time()-n𝘸 if(n.life_span<0)e=true
end if n.remove~=nil then if(n.remove)e=true
end if not e then n:update_func()es(n)else deli(𝘤,f)if(n.shadow~=nil)n.shadow.remove=true
end end end function v(n,f,o)local e=k(n.x,n.z)if n.y+n.vy>e then n.y+=n.vy n.x+=n.vx n.z+=n.vz n.vy-=o*eg[n𝘬]else if(n.is_crash~=nil and n:is_crash())return true
if f then if(abs(n.vy)<.1)n.vy=0n.vx=0n.vz=0n.y=e else n.vy=-n.vy/4
else n.vy=0n.vx=0n.vz=0n.y=e end end end function e𝘢(e,f)local n=false for e in all(e)do if(e==f)n=true
end return n end function g(n,e,f,o,l,d,t,i,c,u,r,a)return n𝘭(0,n,e,f,0,0,0,i,c,t,o,l,d,r,false,u,a)end function 𝘧(n,e,f,o,l,d,t,i,c,u,r,a,h,s)return n𝘭(n,e,f,o,l,d,t,i,c,b,u,r,a,h,s)end function n𝘭(e,n,d,t,i,c,u,r,a,h,s,x,p,v,f,o,l)local n={obj_id=e,x=n,y=d,z=t,ax=c or 0,ay=i or 0,az=u or 0,update_func=r or b,start_func=a or b,vy=x or 0,vx=s or 0,vz=p or 0,life_span=o,disposable=l,verts=𝘴[e][1],tris=𝘴[e][2],t_x=0,t_y=0,t_z=0,d_x=0,d_z=0,t_verts={},draw=h or n𝘫,no_shadow=v}f=f if e==0then n.transform=em if l then if(nh[𝘭]~=nil)nh[𝘭].remove=true
nh[𝘭]=n 𝘭=(𝘭+1)%ei end if not n.no_shadow then n.shadow=g(n.x,k(n.x,n.z),n.z,0,0,0,function(n)local n,e=𝘢(n.t_x,n.t_y,n.t_z)circfill(n,e,0,0)end,function(e)e.x=n.x e.z=n.z+.05e.y=k(n.x,n.z)if(n.y<=e.y)e.remove=true
end,b,o,true)end else n.transform=eb n.draw=n𝘫 if(not n.no_shadow)n.shadow=𝘧(e+1,0,0,0,0,0,0,function(e)e.x=n.x e.z=n.z e.y=k(n.x,n.z)e.ay=n.ay end,b,0,0,0,true)
end if(f)add(_,n)add(w[abs(n.z-y*m)\m],n)else add(𝘤,n)
for e=1,#n.verts do n.t_verts[e]={}for f=1,3do n.t_verts[e][f]=0end end n:start_func()n:transform()return n end e𝘧=peek(24388)e𝘥,e𝘨,i,r,_=0,0,{},{},{}o,n𝘮,𝘵,n6,𝘨,e𝘩,no,nl=1,1,0,0,100,0,3,3n𝘯,n𝘰,nd,e𝘪=time(),time(),false,false n𝘱,n𝘲,n9=0,0,false 𝘹,n1=0,0ek,e𝘸,n𝘳=split"11,4,15,10",split"6,7",split"2,4,10,3,5"j,e𝘫,𝘶={},{},{}eg,n𝘬=split"1, 1.5, 2",1np,𝘩,e𝘣=0,1,split"40,200,200,200,200,200,200"𝘴={[0]={{{0,0,0}},{}}}for n=1742,1807,2do add(𝘴,ef(%n))end ep={[8]=function(n)if(time()%3==0)g(n.x+rnd"10"-4,n.y+10+rnd"8",n.z+rnd"10"-4,0,0,0,function(n)local n,e=𝘢(n.t_x,n.t_y,n.t_z)circfill(n,e,0,5)end,function(n)n.y+=rnd"0.4"n.x+=rnd"0.4"-.2n.z+=rnd"0.4"-.2end,b,4,false,true)
end,[9]=function(n)n.lock_verts=split"1,2,3,4"n.ay=time()𝘧(10,n.x,n.y,n.z,n.ay,nil,nil,nil,nil,nil,nil,nil,true,true)end}pal(1,140,1)pal(13,134,1)pal(15,138,1)pal(2,131,1)function 𝘥()poke(24388,e𝘧)end function 𝘸(n,e,d)local o,f,l=n.x-e.x,0,n.z-e.z if(d)f=n.y-e.y
local n=atan2(o,f)local n=o*cos(n)+f*sin(n)local e=atan2(n,l)return n*cos(e)+l*sin(e)end function n𝘴(e,f,o,n)local l=n and 32or 26local n=𝘧(l,e,f,o,.25,0,0,function(n)v(n,false,0)q(n,6,-1)n.ay+=.03n.ax+=.03n.vx+=(i.x-n.x)/𝘸(i,n)*.06n.vy+=(i.y-n.y)/𝘸(i,n)*.06n.vz+=(i.z-n.z)/𝘸(i,n)*.06𝘷(n,4)n𝘵(n)end,function(e)e.return_death_score=function()return n and 150or 400end e.return_blip_color=function()return n and 8or 14end end)add(r,n)n.is_crash=function()𝘪(n,1000)end end function ed()music(-1,500)add(j,function(n,e,f)local o={}for l=0,3do o[l]=g(n,e,f,0,0,0)end local n=𝘧(4,n,e,f,0,0,0,function(n)local e=k(n.x,n.z)n.ay+=.01if n.landed then if(n.y-1>e+20)n.y-=1
if(n.seed_count>30)for e=0,3do n.landing_gears[e].draw=b end n.landed=false n.dir={rnd"2"-1,rnd"2"-1}
else q(n,4,-1)if(abs(e+50-n.y)>1)n.y+=sgn(e+50-n.y)*.5
n.z+=n.dir[1]n.x+=n.dir[2]if time()%30==0then if(e>20)n.landed=true n.seed_count=0for e=0,3do n.landing_gears[e].draw=function(n)local n,f=𝘢(n.t_x,n.t_y,n.t_z)line(n,f,n+sgn(e-2)*3,f+5,10)end end
end end if e>0then if time()%.5==0then n.seed_count+=1if(n.is_visible)for e=0,7do srand(e*time())local n=g(n.x,n.y,n.z,rnd"4"-2,rnd"4",rnd"4"-2,function(n)local n,e=𝘢(n.t_x,n.t_y,n.t_z)circfill(n,e,0,8)end,function(n)v(n,true,.1)end,b,10)n.is_crash=function(n)n.remove=true nv(n.x,n.z)end end else for e=0,7do srand(e*time())nv(n.x+(rnd"14"-7)*m,n.z+(rnd"14"-7)*m)end
end end 𝘥()end,function(n)n.return_blip_color=function()return 12end n.return_death_score=function()for e=0,3do nm(n.landing_gears[e])end if(n.landed)return 50
return 100end n.landing_gears=o for e=0,3do n.landing_gears[e].update_func=function(f)f.x=n.x+sgn(e-2)*10f.y=n.y-8f.z=n.z+(e%2-1)*10end end n.landed=false n.seed_count=0n.dir={rnd"2"-1,rnd"2"-1}end)add(r,n)end)add(j,function(n,e,f)local n=𝘧(6,n,e,f,.25,0,0,function(n)srand(time())local e=𝘸(i,n)if e<600or n.is_mutated then n𝘶(n,n.y-k(n.x,n.z),e)else if time()-n.shooting_cooldown>.7then local e,f=n.x%u,n.z%u local e=sget(p+e\(s*m),p+c-f\(s*m))if e==4then if(flr(rnd"10")==1)n.tris=𝘴[16][2]n.shooting_interval=.14n.is_mutated=true
end end n.ay+=(n.dir-n.ay)*.02+rnd"0.01"-.02n.x-=sin(n.ay)*3n.z-=cos(n.ay)*3if(time()%10==0)n.dir=rnd"1"
end 𝘥()𝘷(n,4)end,function(n)n.is_mutated=false n.shooting_interval=.7n.return_death_score=function()if(n.is_mutated)return 500else return 300end n.return_blip_color=function()if(n.is_mutated)if(time()%.5<.25)return 8else return 9else return 9end n.shooting_cooldown=time()n.dir=rnd"1"end)add(r,n)n.is_crash=function()𝘪(n,1000)end end)add(j,function(n,e,f)local n=𝘧(19,n,e,f,.25,0,0,function(n)q(n,5,-1)n.ay+=(n.dir-n.ay)*.02n.y=k(n.x,n.z)+100n.x-=sin(n.ay)*3n.z-=cos(n.ay)*3if(time()%1==0)local n=g(n.x,n.y,n.z,0,0,0,function(n)local n,e=𝘢(n.t_x,n.t_y,n.t_z)spr(67,n,e)end,function(n)v(n,true,.2)end)n.is_crash=function(e)e.remove=true for e=-3,3do for f=-3,3do local e,f=e*m,f*m nv(n.x+e,n.z+f)end end end
end,function(n)n.return_death_score=function()return 800end n.return_blip_color=function()if(time()%.5<.25)return 12else return 0end n.dir=rnd"1"end)add(r,n)n.is_crash=function()𝘪(n,1000)end end)add(j,function(n,e,f)local n=𝘧(21,n,e,f,.25,0,0,function(n)n𝘶(n,n.y-k(n.x,n.z))𝘷(n,4)end,function(n)n.shooting_interval=.3n.hit_points=2n.return_death_score=function()if(n.hit_points==0)return 700else n.tris=𝘴[23][2]n.shooting_interval=.6return 200end n.return_blip_color=function()if(time()%.5<.25)return 10else return 0end n.shooting_cooldown=time()n.dir=rnd"1"end)add(r,n)n.is_crash=function()𝘪(n,1000)end end)add(j,function(n,e,f)n𝘴(n,e,f)end)add(j,function(n,e,f)local n=𝘧(28,n,e,f,0,0,0,function(n)q(n,8,-1)n.y=k(n.x,n.z)+100n.ay+=.01n.z+=n.dir[1]n.x+=n.dir[2]n.bean.x,n.bean.y,n.bean.z=n.x,n.y,n.z end,function(n)n.return_blip_color=function()if(time()%.5<.25)return 8else return 0end n.hit_points=5n.bean=g(0,0,0,0,0,0,function(n)local e=𝘸(n,i,true)if(e<100)q(n,9,1)local e,f=𝘢(n.t_x,n.t_y,n.t_z)local o,l=𝘢(i.t_verts[1][1],i.t_verts[1][2],i.t_verts[1][3])srand(time()%2)local d,t=(e+o)/2+rnd(16)-8,(f+l)/2line(e,f,d,t,7)line(d,t,o,l)local n,e=n.x-i.x,n.y-i.y local f=sqrt(n*n+e*e)local f=1/f*.2i.vx+=f*n i.vy+=f*e
end)n.return_death_score=function()if(n.hit_points==0)n.bean.remove=true return 1000else return 0end n.dir={rnd"2"-1,rnd"2"-1}end)add(r,n)end)add(j,function(n,e,f)local n=𝘧(30,n,e,f,.25,0,0,function(n)n.ay+=(n.dir-n.ay)*.02n.y=k(n.x,n.z)+300n.x-=sin(n.ay)*3n.z-=cos(n.ay)*3if time()%8==0then if(𝘸(n,i)<150)n𝘴(n.x,n.y,n.z,true)
end end,function(n)n.return_death_score=function()if(n.hit_points==0)return 2000else return 0end n.return_blip_color=function()return 0end n.hit_points=25n.dir=rnd"1"end)add(r,n)n.is_crash=function(n)𝘪(n,1000)end end)local n=1for f=1808,1878,7do 𝘶[n]={}for e=0,6do for f=1,@(f+e)do add(𝘶[n],{e𝘣[e+1],function()srand(𝘩+o)j[e+1](flr(rnd(u)),300,flr(rnd(u)))end})end end n+=1end n𝘤()nt=n𝘷 ni=n𝘹 nb()end function ev(f,o)local d,t=nf(f,o),n𝘺(f,o)srand(o*f)local i,n=(f%4+o%4+flr((rnd"6")))%4+1,1if(d>0)n=10
if(d>15)n=ek[i]
if(d==l[e])n=e𝘸[(f%2+o%2+flr((rnd"2")))%2+1]
if t>=1then fillp(42405)local e=split"0x46, 0x44, 0x66"if(n==11)n=e[flr(rnd"3")+1]
if(n==4)n=136
local e=split"0x44,0x66,0x88"if(n==15)n=e[flr(rnd"3")+1]
if(n==10)n=138
else fillp()end 𝘥()return n end function n𝘺(n,e)return(a[n][e]&49152)>>>14end function nv(n,f)local o,d=n%u,f%u local n,f,t=o\m,d\m,k(o,d)local i=n𝘺(n,f)if i==0and t>0and t~=l[e]then a[n][f]+=16384sset(p+o\(s*m),p+c-d\(s*m),4)local e=𝘳(n,f)if(e==1)a[n][f]=a[n][f]&~16128|3840
if(e==13)a[n][f]=a[n][f]&~16128|4608
n1+=.00002end end function nc()𝘣(i)n9=true no-=1if(no<0)extcmd"reset"
n𝘲=time()end function nm(n)n.remove=true if(n.shadow~=nil)n.shadow.remove=true
end function e𝘦()print("𝘢ttack 𝘸ave  "..o.." completed",18,60,7)print("𝘢rea infected  . . .     "..tostr(n1,2),7,80,7)print("𝘢rea uninfected  . . .   "..tostr(𝘹,2),7,90,7)print("𝘣onus uninfected area .  "..tostr(n6,2),7,105,7)end function ew()if time()-n𝘱>5then 𝘩=1o+=1if(o>10)extcmd"reset"
if(o==5or o==7)e+=1n𝘬+=1n𝘤()
nt=n𝘷 ni=n𝘹 𝘤={}nm(i)nb()end end function ej()if(#r==0)n6=max(0,(𝘹-n1-n1)/max(32/o,4))𝘵+=n6 dset(0,max(dget(0),𝘵))sfx(7,3)nt=e𝘦 ni=ew n𝘱=time()
end function 𝘣(n)local f=k(n.x,n.z)sfx(3,2)for e=0,7do srand(e)g(n.x+rnd"10"-4,n.y+10+rnd"8",n.z+rnd"10"-4,0,0,0,function(n)local n,f=𝘢(n.t_x,n.t_y,n.t_z)for o=0,5do srand(o*e)circfill(n+rnd"5"-4,f+rnd"5"-4,0,5)end end,function(n)n.y+=rnd"0.4"n.x+=rnd"0.4"-.2n.z+=rnd"0.4"-.2end,b,4,false,true)end for e=0,15do srand(e)local e=n𝘳[flr(rnd"5")+1]if(f==0and n.y<=1)e=12-flr(rnd"2")*5
g(n.x,n.y,n.z+5,rnd"2"-1,rnd"4"+2,rnd"2"-1,function(n)local n,f=𝘢(n.t_x,n.t_y,n.t_z)circfill(n,f,0,e)end,function(n)v(n,true,.2)end,b,10,false,true)end 𝘥()nm(n)del(r,n)ej()end function q(n,e,f)if(n.is_visible)sfx(e,f)
end function n𝘵(n)srand(n.x)if(time()%0x.08==0)g(n.x+rnd"16"-8,n.y+rnd"16"-8,n.z+5,0,0,0,function(n)local n,e=𝘢(n.t_x,n.t_y,n.t_z)circfill(n,e,0,5)end,b,b,3)
end function n𝘢(n,f,e)local e,f=e or false,f or.2if 𝘨>0and e or not e then if(𝘨>0and e)𝘨-=.05
n.vy+=f*cos(n.ax)*cos(n.az)n.vx+=f*sin(n.ay)*-sin(n.ax)n.vz+=f*-cos(n.ay)*sin(n.ax)local e,f,o=cos(n.ax)*cos(n.az),sin(n.ay)*-sin(n.ax),-cos(n.ay)*sin(n.ax)q(n,0,1)if n.is_visible then srand(time())for l=0,1do srand(l*time())g(n.x+rnd"8"-4,n.y+rnd"8"-4,n.z+rnd"8"+4+20,-f*4+rnd"2"-1+n.vx,-e*4+n.vy+rnd"2"-1,-o*4+rnd"2"-1+n.vz,function(n)local f,o=𝘢(n.t_x,n.t_y,n.t_z)local e=7+rnd"1"*3if(n.life_span<.2)e=8
circfill(f,o,0,e)end,function(n)v(n,true,.1)end,function(e)e.y=n.y+.001end,.4)end 𝘥()end end end function n𝘻(n)local e,f,o=sin(n.ax),sin(n.ay)*cos(n.ax),cos(n.ay)*cos(n.ax)q(n,1,2)local n=g(n.x,n.y,n.z,10*-f+n.vx,10*-e+n.vy,10*-o+n.vz,function(n)local n,e=𝘢(n.t_x,n.t_y,n.t_z)circfill(n,e,0,7)end,function(e)v(e,false,0)if(n_(e,n))e.life_span=-1
en(e)end,b,1)n.is_crash=function(n)q(n,2,1)n.remove=true local f=k(n.x,n.z)for e=0,5do srand(e*time())local e=12-flr(rnd"2")*5if(f>0)e=n𝘳[flr(rnd"5")+1]
g(n.x,n.y,n.z,rnd"2"-1,rnd"2",rnd"2"-1,function(n)local n,f=𝘢(n.t_x,n.t_y,n.t_z)circfill(n,f,0,e)end,function(n)v(n,true,.1)end,b,1,false,true)end 𝘥()end end function n𝘶(n,f,e)local o=e or 𝘸(i,n)v(n,false,.05)local l,e=-atan2(i.x-n.x,i.z-n.z),-atan2(o,i.y-n.y)if o>100then n𝘢(n,.4)if(n.y-i.y<20or f<60)e=-.15else e=-.25
else if(n.y-i.y<3or f<60)n𝘢(n,.2)e=0
if(time()-n.shooting_cooldown>n.shooting_interval)n𝘻(n)n.shooting_cooldown=time()
end n.ay+=(l+.25-n.ay)*.3n.ax+=(e-n.ax)*.5end function 𝘪(n,e)if(n.hit_points)n.hit_points-=e
local e=n.return_death_score()nu(e>>16)e0(n,e)sfx(10,3)if(not n.hit_points or n.hit_points<=0)𝘣(n)
end function n_(l,f,o)o,f=o or 1,f or l local n=r n[0]=i for e=#n,0,-1do if n[e].y~=f.y and n[e].x~=f.x then if 𝘸(l,n[e],true)<20then if(e>0)𝘪(r[e],o)else 𝘨-=20
return true end end end return false end function e0(n,e)if(e~=0)g(n.x,n.y,n.z,0,0,0,function(n)local n,f=𝘢(n.t_x,n.t_y,n.t_z)print(e,n,f,7)end,function(n)n.y+=.1end,b,5,false,true)
end function en(o)for n=#_,1,-1do if sqrt(abs(o.d_x-_[n].d_x)+abs(o.y-_[n].y)+abs(o.d_z-_[n].d_z))<5then _[n].vx=o.vx _[n].vz=o.vz _[n].vy=o.vy local e,f=f(_[n].d_x%u),f(_[n].d_z%u)local l=𝘳(e,f)if l==1or l==15then 𝘣(_[n])a[e][f]=a[e][f]&~16128|2048if(l==15)nu(.00062)e0(o,"40")
end if(l==6)nu(.00062)𝘣(_[n])a[e][f]=a[e][f]&~16128|2048
if(l==9)𝘣(_[n])a[e][f]=a[e][f]&~16128|2816
if(l==13)𝘣(_[n])a[e][f]=a[e][f]&~16128|3584
return true end end return false end function nu(n)𝘵+=n if(𝘵>n𝘮*.0763)n𝘮+=1no+=1nl+=1
end function nb()i=𝘧(2,118*m,0,118.5*m,.25,0,0,function(n)v(n,false,.12)if(n_(n))nc()
if(en(n))nc()
if n.y>𝘬 then if(btn"0")n.ay+=.03
if(btn"1")n.ay-=.03
if btn"2"then if(abs(n.ax-.02)<.2)n.ax-=.02
end if btn"3"then if(abs(n.ax+.02)<.2)n.ax+=.02
end if time()%.00002==0then if(n.y>200)srand(time())g(n.x+rnd"200"-100,n.y+rnd"200"-50,n.z+rnd"200"-100,0,0,0,function(n)local n,e=𝘢(n.t_x,n.t_y,n.t_z)circfill(n,e,0,7)end,b,b,3,true,true)
end else if(𝘬==l[e])𝘨=100
end if n.y<1200then if(btn"4")n𝘢(n,.5,true)
end 𝘷(n,8)poke(24413,5)if btn"5"then if(time()-n𝘯>.1)n𝘻(n)nu(~0)n𝘯=time()
if not nd then if time()-n𝘰<.2then nl-=1if nl>=0then local n=𝘧(24,n.x,n.y,n.z,n.ay,n.ax,0,function(e)v(e,false,0)local f,o=𝘸(e,e.target),-atan2(e.d_x-e.target.d_x,e.d_z-e.target.d_z)e.ay+=o-.25-e.ay local f=atan2(f,e.y-e.target.y)e.ax+=f-e.ax e.vx-=sin(e.ay)e.vy-=sin(e.ax)e.vz-=cos(e.ay)if(n_(e,n,100))𝘣(e)
𝘷(e,10)n𝘵(e)end,function(n)n.life_span=10local e,f=0,32767for o=1,#r do local n=𝘸(n,r[o])if(n<f)e,f=o,n
end n.target=r[e]end,n.vx-sin(n.ay)*15,n.vy-sin(n.ax)*15,n.vz-cos(n.ay)*15)n.is_crash=function(n)𝘣(n)end end end n𝘰,nd=time(),true end else if(nd)nd=false
end 𝘥()end)i.is_crash=function(n)if(sqrt(n.vx^2+n.vy^2+n.vz^2)>3or abs(n.ax)>.03)nc()
end n=i end function 𝘷(n,e)local f=sqrt(n.vx^2+n.vy^2+n.vz^2)local e=f>e and e/f or 1n.vx,n.vy,n.vz=e*n.vx,e*n.vy,e*n.vz end function e𝘬()𝘣(i)nc()end function n𝘹()if(n9)if(time()-n𝘲>5)n9=false nb()
e_()n𝘸=time()_={}𝘺,𝘻=n.x,n.z-et if(n.y>𝘬+50)𝘦=n.y-20else 𝘦=𝘬+30
np+=1if 𝘩<#𝘶[o]+1then if(np>=𝘶[o][𝘩][1])np=0𝘶[o][𝘩][2]()𝘩+=1
end end function eq()rectfill(c+1,0,128,12,6)print("score",c+1+1,1,7)print(tostr(𝘵,2),c+1+1,7,7)for n=1,nl do spr(65,58+n*5+3,5)end for n=1,no do spr(64,58+n*5,0)end print("wave",c+1+58,1,7)print(o,c+1+58,7,7)print("best",c+1+78,1,7)print(tostr(dget(0),2),c+1+78,7,7)rectfill(c,14,𝘨+c,14,10)rectfill(c,16,i.y/7+c,16,11)end function n𝘷()e6()eq()e7()end ni=el nt=e1 function _init()cartdata"marcospiv_prion_v1"eo()end function _update()ni()end function _draw()nt()end
__gfx__
b130005050a030700050000000500060a00000005000509160a05000c040506000102030407080903050000010b1200000001050400090801050600000403040
3000205000204000504210206030203060303040603040506030501060b0103020c0305040c0105030cd708090a040004030f020000000005040009080005060
0000c010205000203050003040500040004030e140200010201040404000204010207040208070207080204070201040004004102030c020403010405030c050
603010607030c070803010809030c09010301010a0201020a0400c40a0501050a0600c60a0701070a0800c80a0901090a0100c40304050b14000001000104000
4000004010007040008070007080004070001002102030002040300040503000506030006070300070803000809030009010300040004050b140000000004040
304000008040308080008080004040004040009083102030402040308040503040603050406070308070103040108020a0208040a0408090a0908060a0608070
a0708010a0409050d0605090d0402040205140000000004000008080008080004040004040009081102060002030600030706000704060004050600050106000
40004020c04000000000000030004080008010203050304020502000003081600040400060608060800060606000006080c0608060506002102030c030401010
30506050307050606050805050708050306080607030805060006040c0600000000080600060c0008080102030003040100060006040c0600040400060608060
8000608010203050304010006000604021000000102000201000100000302000300000c0102030c0304010c0305060c020100030211000400020405000406020
40304040000000016010300010203030104030301050303030004030c040000000000000300040800080102030503040205020000010b130005050a030700050
000000500060a00000005000509160a05000c04050600010203040708090e050000010b140000000004040304000008040308080008080004040004040009083
102030e020403010405030e0603050e060703010701030e0108020a0208040a0408090a0908060a0608070a0708010a040905080605090804020402051400000
00004000008080008080004040004040009081102060002030600030706000704060004050600050106000400040202110004000204050004060204030404000
00000160103000102030e0104030e0105030e030004030216020004040c08040c00020a0c020a06000b00220301010201040c0305010c0401060a0506010a040
6020cd503060cd302060a050206030c06000000000a0c000a06000b080401020001040300050006030815000600020609020a05040601020a0a0206050403050
20000340501070103040704020508050201040301060403060408060704054706080402040705470802040208010906010809050205030215000600000609000
a01000a0a00060500000011020400050103000106020006010500050005030815000600020609020a05040601020a0a0206050403050200003405010f0103040
f040205030502010a0301060a030604030607040b0706080f0204070b0708020f0208010a0601080a050205030725030a03050a03010a01030a0303000304050
306090003090203050603090403050300090302050832030104030204040501030705020107050402070503040706020708080904080a010b080c030d080d030
c080b010a080409080807020608030305020511000a05000a0300000000090200050600090400050c02030100060702000105040003000502021200020003040
00300020602040304040300002106030e0506010a0103020a0205010e0406050e0604030a0203040e0204050a020302030c00000400000004000404000008020
1040001030400020002030b17000700030707030007030e0e0307080606080608060608060606083105030a0405010a010302090204010906090307060507070
704080708020907050407080208040803090208050603080709060708090707070307030c00000707000007000e0e0007080201040001030400070007030e100
000040207020400060400080000040200000008020408080008060408004801070601080306060103060406030706040506050a09060a05040604080a0603080
4060208070602090a0608020a0707010606060207060205090605020606040204030c00000800000008000808000008020104000103040004000403021200020
00304000300020602040304040300002106030805060108010302080205010804060507060403070203040702040507020302010c00000400000004000404000
00802010400010304000200020100000d200270039007f00831019104c10ed10c120632005204720c9206b203e20c330f6307930fc309e307340f540da402150
93501750b8504e50ef502660c7604b60301000000000004010100000000050401010000000104020405010001040204050200010203040602010201030308030
10101040509030201010406090302010104050903020000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00030000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00333000000000000000000000777700000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0333b30000007700c000000007777770000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
3333b330000775001c0cccc077777777000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
3333bb3388775000c1cccccc60000606000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0333bb33877500001c1c1c1066006006000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0033bbb077580000c101c10006666666000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0003bbb0758800001000000000666660000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000066000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
__sfx__
01010000166221a6221a622196221762213622106220f622116221462217622186221762217622166221562213622106220c6220a622076220662204622036120261202612016120161200610006100061000610
000100001a6202362029420377202472019720147200b720077200572003720027200172001720017200000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0101000021650294502a6501f15017650000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
3509000005133386321f63218632136320f6320c6320a632086220661205612046120361202612016120061200600006000060000600006000060000600316002e6002b60028600236001d600176000d60008600
010e000004730101001010010100101000f1000c0000f100080000800000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
591000001b33000500000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
254602003851238502207002070020700207002070020700207002070020700207002070020700207002070014000140001400014000140001400000000000000000000000000000000000000000000000000000
611000001a0501a0251a7001a0501a0311a0252600026000260010900107001050010400103001010010000100001000000000000000000000000000000000000000000000000000000000000000000000000000
011101000f2131b3001b30000000000000000000000110001b500000000000000000000000000000000000001b500000000000000000000000000000000000001b50000000000000000000000000000000027200
3d110000336140c6000c6000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
010e000029622186220a6220a6150a6000a6000a6020a600000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
01100000130233f2050000000002000030c023000030000300003000031802300003000030c023000030000318023000030000300003000030c023000030000300003000001802300000000000c0230000000000
491000000f6250160500605186050c6050f625000030000300003000030f6151b6150000503615000030000303615045030550309503000031b615000030960300003000031b6150f61500003336252761500000
c91000000051400510005100051000510005140051000510005100051000514005100051000514005110051108511085110851008510085100851408510085100851008510085140851008510085100851008511
011000000051202512035120051502500005000050200502000010000100001000010000100001000010000108511085110851108511085110851108511085110851108511085110851108511085110851108511
011000000c5100e5110f5110c5110c5110c5110c5100c5100c5100c5100c5100c5100c5100c5100c5100c51014511145111451114511145111451114511145111451114511145111451114511145111451114511
001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0020000018c5000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
__music__
01 14151657
01 14151617
02 14151618
__meta:title__

V1
